<Window x:Class="ScratchCardGenerator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ScratchCardGenerator"
        xmlns:viewModels="clr-namespace:ScratchCardGenerator.ViewModels"
        xmlns:editor="clr-namespace:ScratchCardGenerator.Common.Views;assembly=ScratchCardGenerator.Common"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" Height="768" Width="1366" WindowState="Maximized"
        Background="{DynamicResource PrimaryBackgroundBrush}"
        Foreground="{DynamicResource TextBrush}"
        Closed="Window_Closed"
        Closing="Window_Closing"
        Icon="icon.ico">

    <Window.DataContext>
        <viewModels:MainWindowViewModel/>
    </Window.DataContext>

    <Window.InputBindings>
        <KeyBinding Command="{Binding UndoCommand}" Gesture="Ctrl+Z" />
        <KeyBinding Command="{Binding RedoCommand}" Gesture="Ctrl+Y" />
    </Window.InputBindings>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <DockPanel>
        <DockPanel DockPanel.Dock="Top">
            <Menu DockPanel.Dock="Top">
                <MenuItem Header="_File">
                    <MenuItem Header="_New Project" Command="{Binding NewProjectCommand}"/>
                    <MenuItem Header="_Load Project..." Command="{Binding LoadProjectCommand}"/>
                    <MenuItem Header="_Save Project" Command="{Binding SaveProjectCommand}"/>
                    <MenuItem Header="Save Project _As..." Command="{Binding SaveProjectAsCommand}"/>
                    <Separator/>
                    <MenuItem Header="Save As Template..." Command="{Binding SaveAsTemplateCommand}" />
                    <MenuItem Header="New from Template..." Command="{Binding NewFromTemplateCommand}" />
                    <Separator/>
                    <MenuItem Header="Recent Files" ItemsSource="{Binding RecentFiles}">
                        <MenuItem.ItemContainerStyle>
                            <Style TargetType="MenuItem">
                                <Setter Property="Header" Value="{Binding}"/>
                                <Setter Property="Command" Value="{Binding DataContext.OpenRecentFileCommand, RelativeSource={RelativeSource AncestorType=Menu}}"/>
                                <Setter Property="CommandParameter" Value="{Binding}"/>
                            </Style>
                        </MenuItem.ItemContainerStyle>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="E_xit" Command="{Binding ExitCommand}"/>
                </MenuItem>
                <MenuItem Header="_Edit">
                    <MenuItem Header="_Undo" Command="{Binding UndoCommand}" InputGestureText="Ctrl+Z"/>
                    <MenuItem Header="_Redo" Command="{Binding RedoCommand}" InputGestureText="Ctrl+Y"/>
                </MenuItem>
                <MenuItem Header="_Tools">
                    <MenuItem Header="Show Advanced Analysis..." Command="{Binding ShowAdvancedAnalysisCommand}"/>
                    <!-- NEW: Menu item to open the job folder. -->
                    <MenuItem Header="Open Job Folder..." Command="{Binding OpenJobFolderCommand}"/>
                    <Separator/>
                    <MenuItem Header="Import Prizes..." Command="{Binding ImportPrizesCommand}"/>
                    <MenuItem Header="Export Prizes..." Command="{Binding ExportPrizesCommand}"/>
                    <Separator/>
                    <MenuItem Header="Import Symbols..." Command="{Binding ImportSymbolsCommand}"/>
                    <MenuItem Header="Export Symbols..." Command="{Binding ExportSymbolsCommand}"/>
                </MenuItem>
                <MenuItem Header="_Help">
                    <MenuItem Header="Help Guide..." Command="{Binding ShowHelpGuideCommand}"/>
                    <MenuItem Header="About..." Command="{Binding ShowAboutWindowCommand}"/>
                </MenuItem>
            </Menu>
            <ToolBar>
                <Button Content="New" Command="{Binding NewProjectCommand}" ToolTip="Creates a new, empty project."/>
                <Button Content="Load" Command="{Binding LoadProjectCommand}" ToolTip="Loads an existing project from a file."/>
                <Button Content="Save" Command="{Binding SaveProjectCommand}" ToolTip="Saves the current project to its file."/>
                <Separator/>
                <Button Command="{Binding RunFullGenerationCommand}" FontWeight="Bold" Foreground="{DynamicResource AccentForegroundBrush}" ToolTip="Runs the entire generation process (LVW, HVW, and Combined) in one step.">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Run Full Generation" VerticalAlignment="Center" Margin="5,0"/>
                    </StackPanel>
                </Button>

                <Separator/>
                <Button Content="Generate LVW" Command="{Binding GenerateLvwCommand}" ToolTip="Generates the Low-Value Winner data file."/>
                <Button Content="Generate HVW" Command="{Binding GenerateHvwCommand}" ToolTip="Generates the High-Value Winner data file."/>
                <Button Content="Generate Combined Files" Command="{Binding GenerateCombinedFileCommand}" ToolTip="Combines LVW and HVW files to generate all final reports."/>
                <Separator/>
                <Button Content="Check LVW" Command="{Binding CheckLvwCommand}" ToolTip="Analyses a generated LVW file for correctness."/>
                <Button Content="Check HVW" Command="{Binding CheckHvwCommand}" ToolTip="Analyses a generated HVW file for correctness."/>
                <Button Content="Print Barcodes" Command="{Binding PrintBarcodesCommand}" ToolTip="Generates a PDF of all prize barcodes."/>
            </ToolBar>
        </DockPanel>

        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}"/>
            </StatusBarItem>
            <StatusBarItem DockPanel.Dock="Right" HorizontalAlignment="Right">
                <ProgressBar Width="150" Height="18" 
                             Value="{Binding ProgressValue}" 
                             Visibility="{Binding IsProgressVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </StatusBarItem>
        </StatusBar>

        <editor:ProjectEditorControl DataContext="{Binding EditorViewModel}" />

    </DockPanel>
</Window>
