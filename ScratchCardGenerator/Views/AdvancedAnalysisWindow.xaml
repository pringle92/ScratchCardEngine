<Window x:Class="ScratchCardGenerator.Views.AdvancedAnalysisWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:ScratchCardGenerator.ViewModels"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance Type=viewModels:AdvancedAnalysisViewModel}"
        Title="Advanced Game Analysis" Height="700" Width="1000"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource PrimaryBackgroundBrush}"
        Foreground="{DynamicResource TextBrush}">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Per-Game Allocation Grid -->
        <GroupBox Grid.Row="0" Header="Per-Game Win Allocation" Margin="0,0,0,10">
            <DataGrid ItemsSource="{Binding GameBreakdown}" AutoGenerateColumns="False" IsReadOnly="True"
                      SelectionUnit="FullRow" SelectionMode="Single"
                      SelectedItem="{Binding SelectedGame, Mode=TwoWay}"
                      x:Name="GameBreakdownGrid">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Game No." Binding="{Binding GameNumber}" Width="Auto"/>
                    <DataGridTextColumn Header="Game Name" Binding="{Binding GameName}" Width="*"/>
                    <DataGridTextColumn Header="Total Allocated Wins" Binding="{Binding TotalWins, StringFormat={}{0:N0}}" Width="Auto"/>
                    <DataGridTextColumn Header="Share of Wins" Binding="{Binding WinSharePercentage}" Width="Auto"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- Charts Area -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Text="{Binding ChartTitle}" FontSize="16" FontWeight="SemiBold" Margin="5,0,0,10"/>

            <!-- LVW Chart -->
            <GroupBox Grid.Row="1" Header="Low-Value Winners (per print run)">
                <lvc:CartesianChart Series="{Binding LvwPrizeSeries}" LegendLocation="None">
                    <lvc:CartesianChart.DataTooltip>
                        <lvc:DefaultTooltip BulletSize="15" Background="{DynamicResource SecondaryBackgroundBrush}" Foreground="{DynamicResource TextBrush}" BorderBrush="{DynamicResource BorderBrush}"/>
                    </lvc:CartesianChart.DataTooltip>
                    <lvc:CartesianChart.AxisX>
                        <lvc:Axis Labels="{Binding PrizeTierLabels}" Foreground="{DynamicResource TextBrush}" LabelsRotation="-45">
                            <lvc:Axis.Separator>
                                <lvc:Separator StrokeThickness="0" />
                            </lvc:Axis.Separator>
                        </lvc:Axis>
                    </lvc:CartesianChart.AxisX>
                    <lvc:CartesianChart.AxisY>
                        <lvc:Axis Title="Number of Winners" Foreground="{DynamicResource TextBrush}" LabelFormatter="{Binding YAxisFormatter}">
                            <lvc:Axis.Separator>
                                <lvc:Separator StrokeThickness="0.5" StrokeDashArray="2" Stroke="{DynamicResource BorderBrush}"/>
                            </lvc:Axis.Separator>
                        </lvc:Axis>
                    </lvc:CartesianChart.AxisY>
                </lvc:CartesianChart>
            </GroupBox>

            <!-- HVW Chart -->
            <GroupBox Grid.Row="2" Header="High-Value Winners (total job)">
                <lvc:CartesianChart Series="{Binding HvwPrizeSeries}" LegendLocation="None">
                    <lvc:CartesianChart.DataTooltip>
                        <lvc:DefaultTooltip BulletSize="15" Background="{DynamicResource SecondaryBackgroundBrush}" Foreground="{DynamicResource TextBrush}" BorderBrush="{DynamicResource BorderBrush}"/>
                    </lvc:CartesianChart.DataTooltip>
                    <lvc:CartesianChart.AxisX>
                        <lvc:Axis Labels="{Binding PrizeTierLabels}" Foreground="{DynamicResource TextBrush}" LabelsRotation="-45">
                            <lvc:Axis.Separator>
                                <lvc:Separator StrokeThickness="0" />
                            </lvc:Axis.Separator>
                        </lvc:Axis>
                    </lvc:CartesianChart.AxisX>
                    <lvc:CartesianChart.AxisY>
                        <lvc:Axis Title="Number of Winners" Foreground="{DynamicResource TextBrush}" LabelFormatter="{Binding YAxisFormatter}">
                            <lvc:Axis.Separator>
                                <lvc:Separator StrokeThickness="0.5" StrokeDashArray="2" Stroke="{DynamicResource BorderBrush}"/>
                            </lvc:Axis.Separator>
                        </lvc:Axis>
                    </lvc:CartesianChart.AxisY>
                </lvc:CartesianChart>
            </GroupBox>
        </Grid>

        <!-- Bottom Buttons -->
        <DockPanel Grid.Row="2" Margin="0,10,0,0">
            <Button Content="Show All Games" Command="{Binding ClearSelectionCommand}" Width="120" HorizontalAlignment="Left"/>
            <Button Content="Close" Width="100" HorizontalAlignment="Right" IsCancel="True"/>
        </DockPanel>
    </Grid>
</Window>
